(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d622c"],{"70eb":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-header-index-wide"},[a("a-modal",{attrs:{title:"详情",width:650,visible:e.visible,confirmLoading:e.confirmLoading},on:{ok:e.handleSubmit,cancel:e.handleCancel}},[a("a-form",{attrs:{form:e.form,layout:"horizontal"}},[a("a-form-item",{attrs:{label:"唯一识别码",hasFeedback:"","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入唯一识别码!"}]}],expression:"[\n            'name',\n            {\n              rules: [{ required: true, message: '请输入唯一识别码!' }]\n            }\n          ]"}],attrs:{placeholder:"请入唯一识别码（英文即可）"}})],1),a("a-form-item",{attrs:{label:"上级管理员",hasFeedback:"","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-tree-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["pid",{rules:[{required:!0,message:"请选择上级管理员!"}]}],expression:"[\n            'pid',\n            {\n              rules: [{ required: true, message: '请选择上级管理员!' }]\n            }\n          ]"}],attrs:{dropdownStyle:{maxHeight:"400px",overflow:"auto"},placeholder:"选择上级管理员",allowClear:"",treeDefaultExpandAll:"",treeData:e.roleTree},on:{change:e.handleTreeChange}})],1),a("a-form-item",{attrs:{label:"角色名称",hasFeedback:"","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title",{rules:[{required:!0,message:"请输入角色名称!"}]}],expression:"[\n            'title',\n            {\n              rules: [{ required: true, message: '请输入角色名称!' }]\n            }\n          ]"}],attrs:{placeholder:"请入角色名称"}})],1),a("a-form-item",{attrs:{label:"状态",hasFeedback:"","label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["status",{rules:[{required:!0,message:"请选择状态!"}]}],expression:"[\n            'status',\n            {\n              rules: [{ required: true, message: '请选择状态!' }]\n            }\n          ]"}],attrs:{placeholder:"请选择"}},[a("a-select-option",{attrs:{value:1}},[e._v(" 启用 ")]),a("a-select-option",{attrs:{value:0}},[e._v(" 禁用 ")])],1)],1),e.form.getFieldValue("pid")?a("a-form-item",{attrs:{label:"拥有权限",hasFeedback:"","label-col":{span:4},"wrapper-col":{span:20}}},e._l(e.rules,(function(t,n){return a("a-row",{key:n},[a("a-col",{attrs:{xl:5}},[e._v(" "+e._s(t.title)+"： ")]),a("a-col",{attrs:{xl:19}},[t.actions.length>0?a("a-checkbox",{attrs:{indeterminate:t.indeterminate,checked:t.checkedAll},on:{change:function(a){return e.onCheckAllChange(a,t)}}},[e._v(" 全选 ")]):e._e(),a("a-checkbox-group",{attrs:{options:t.actions},on:{change:function(a){return e.onChange(t)}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"item.selected"}})],1)],1)})),1):e._e()],1)],1),a("a-modal",{attrs:{title:"分配数据权限",width:500,visible:e.dataVisible,confirmLoading:e.confirmLoading},on:{ok:e.handleDataSubmit,cancel:e.handleCancel}},[a("a-form",{attrs:{form:e.dataForm}},[a("a-form-item",{attrs:{label:"唯一识别码",hasFeedback:""}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name"],expression:"[\n            'name'\n          ]"}],attrs:{readonly:""}})],1),a("a-form-item",{attrs:{label:"角色名称",hasFeedback:""}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title"],expression:"[\n            'title'\n          ]"}],attrs:{readonly:""}})],1),a("a-form-item",{attrs:{label:"数据范围",hasFeedback:""}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["mode",{rules:[{required:!0,message:"请输入角色名称!"}]}],expression:"[\n            'mode',\n            {\n              rules: [{ required: true, message: '请输入角色名称!' }]\n            }\n          ]"}],on:{change:e.handleSelectChange}},[a("a-select-option",{attrs:{value:1}},[e._v("全部数据权限")]),a("a-select-option",{attrs:{value:2}},[e._v("自定义数据权限")]),a("a-select-option",{attrs:{value:3}},[e._v("本部门数据权限")]),a("a-select-option",{attrs:{value:4}},[e._v("本部门及以下数据权限")]),a("a-select-option",{attrs:{value:5}},[e._v("仅本人数据权限")])],1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:2===e.dataForm.getFieldValue("mode"),expression:"dataForm.getFieldValue('mode') === 2"}],attrs:{label:"数据权限",hasFeedback:""}},[a("a-tree",{directives:[{name:"decorator",rawName:"v-decorator",value:["deptIds",{rules:[{required:!0,message:"请选择数据权限!"}]}],expression:"[\n            'deptIds',\n            {\n              rules: [{ required: true, message: '请选择数据权限!' }]\n            }\n          ]"}],attrs:{checkable:"",autoExpandParent:!0,treeData:e.deptTreeData,showLine:!0,expandedKeys:e.expandedKeys},on:{expand:e.onExpand,select:e.onSelect},model:{value:e.checkedKeys,callback:function(t){e.checkedKeys=t},expression:"checkedKeys"}})],1)],1)],1),a("a-card",{attrs:{"body-style":{padding:0}}},[a("div",{staticClass:"ant-pro-table-toolbar"},[a("div",{staticClass:"ant-pro-table-toolbar-title"},[e._v("角色列表")]),a("div",{staticClass:"ant-pro-table-toolbar-option"},[a("div",{staticClass:"ant-pro-table-toolbar-item"},[a("a-button",{directives:[{name:"action",rawName:"v-action:RoleAdd",arg:"RoleAdd"}],attrs:{type:"primary",icon:"plus"},on:{click:function(t){e.visible=!0}}},[e._v("新建")])],1),e.selectedRows.length?[a("div",{staticClass:"ant-pro-table-toolbar-item"},[a("a-dropdown",[a("a-menu",{attrs:{slot:"overlay"},on:{click:e.handleMenuClick},slot:"overlay"},[a("a-menu-item",{key:"remove"},[a("a-icon",{attrs:{type:"delete"}}),e._v("批量删除")],1)],1),a("a-button",{staticStyle:{"margin-left":"8px"}},[e._v(" 批量操作 "),a("a-icon",{attrs:{type:"down"}})],1)],1)],1)]:e._e(),a("a-divider",{attrs:{type:"vertical"}}),a("span",{staticClass:"ant-pro-table-toolbar-item-icon"},[a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[e._v("刷新")])]),a("a-icon",{attrs:{type:"reload"},on:{click:function(t){return e.refreshTable()}}})],2)],1)],2)]),a("s-table",{ref:"table",attrs:{size:"default",rowKey:function(e){return e.id},columns:e.columns,data:e.loadData,alert:!0,expandRowByClick:!0,expandIcon:e.expandIcon,showPagination:!1,rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange}},scopedSlots:e._u([{key:"status",fn:function(t){return[a("a-badge",{attrs:{status:e._f("statusTypeFilter")(t.status),text:e._f("statusFilter")(t.status)}})]}},{key:"fulltitle",fn:function(t){return[a("span",{domProps:{innerHTML:e._s(t.title)}})]}},{key:"expandedRowRender",fn:function(t){return a("p",{},[a("a-row",e._l(e.rules,(function(n,s){return a("a-col",{key:s,staticClass:"rule-list",attrs:{span:"12"}},[a("a-row",[a("a-col",{attrs:{span:"4"}},[e._v(e._s(n.title)+"：")]),a("a-col",{attrs:{span:"20"}},[n.actions.length?e._e():[e._v("-")],e._l(n.actions,(function(n,s){return[-1!==t.permissions.indexOf(n.id)?a("a-tag",{key:s},[e._v(" "+e._s(n.title)+" ")]):e._e()]}))],2)],1)],1)})),1)],1)}},{key:"tools",fn:function(t){return[a("a",{directives:[{name:"action",rawName:"v-action:RoleUpdate",arg:"RoleUpdate"}],on:{click:function(a){return e.openInfoModal(t)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{directives:[{name:"action",rawName:"v-action:RoleUpdate",arg:"RoleUpdate"}],on:{click:function(a){return e.openDataInfoModal(t)}}},[e._v("数据权限")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{directives:[{name:"action",rawName:"v-action:RoleDelete",arg:"RoleDelete"}],on:{click:function(a){return e.showDeleteConfirm(t.id)}}},[e._v("删除")])]}}])})],1)],1)},s=[],i=(a("7db0"),a("c975"),a("d81d"),a("b0c0"),a("d3b7"),a("25f0"),a("2af9")),o=(a("99af"),a("b775")),r=a("365c");function l(e){return Object(o["b"])({url:r["a"].Role,method:"get",params:e})}function c(e){return Object(o["b"])({url:r["a"].Role,method:"post",data:e})}function d(e,t){return Object(o["b"])({url:"".concat(r["a"].Role,"/").concat(e),method:"put",data:t})}function u(e){return Object(o["b"])({url:"".concat(r["a"].Role,"/").concat(e),method:"delete"})}function p(e,t){return Object(o["b"])({url:"".concat(r["a"].Role,"/").concat(e,"/mode"),method:"put",data:t})}var m={0:{status:"default",text:"已禁用"},1:{status:"processing",text:"使用中"}},h=[{title:"唯一识别码",dataIndex:"name"},{title:"角色名称",scopedSlots:{customRender:"fulltitle"}},{title:"状态",scopedSlots:{customRender:"status"}},{title:"操作",scopedSlots:{customRender:"tools"}}],f={data:function(){var e=this;return{expandedKeys:[],labelCol:{span:4},wrapperCol:{span:20},selectedKeys:[],checkedKeys:[],description:"列表使用场景：后台管理中的权限管理以及角色管理，可用于基于 RBAC 设计的角色权限控制，颗粒度细到每一个操作类型。",loading:!1,confirmLoading:!1,visible:!1,dataVisible:!1,customDataVisable:!1,form:this.$form.createForm(this,{name:"role"}),dataForm:this.$form.createForm(this,{name:"dept"}),rules:[],allActionIds:[],selected:0,info:{},data:[],columns:h,roleTree:[],deptTreeData:[],queryParam:{},loadData:function(t){return l(Object.assign(t,e.queryParam)).then((function(t){var a=t.result,n=a.rules,s=a.roles,i=a.depts,o=s.data,r=s.tree;return e.data=o,e.roleTree=r,e.deptTreeData=i,e.rulesSelectedInit(n),s}))},selectedRowKeys:[],selectedRows:[]}},components:{STable:i["r"]},watch:{checkedKeys:function(e){this.dataForm.setFieldsValue({deptIds:e})}},filters:{statusFilter:function(e){return m[e].text},statusTypeFilter:function(e){return m[e].status}},methods:{handleDataSubmit:function(){var e=this;this.dataForm.validateFields((function(t,a){t||p(e.selected,a).then((function(t){e.$notification["success"]({message:"成功通知",description:"更新成功！"}),e.handleCancel(),e.refreshTable()}))}))},handleSubmit:function(){var e=this;this.form.validateFields((function(t,a){if(!t){var n=[];e.rules.map((function(e){e.selected.map((function(e){n.push(e)}))})),a.rules=n;var s=0===e.selected?c(a):d(e.selected,a);e.confirmLoading=!0,s.then((function(t){e.$notification["success"]({message:"成功通知",description:0===e.selected?"添加成功！":"更新成功！"}),e.handleCancel(),e.refreshTable()})).finally((function(){e.confirmLoading=!1}))}}))},handleCancel:function(){this.visible=!1,this.dataVisible=!1,this.form.resetFields(),this.selected=0,this.loading=!1,this.rules.map((function(e){e.selected=[],e.indeterminate=!1,e.checkedAll=!1,e.actions.map((function(e){e.disabled=!1}))}))},filterRuleAction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";if(this.selected>0){var t=this.info.pid;e=t.toString()}var a=this.data,n=this.rules,s=[];if("1"!==e){var i=a.find((function(t){if(t.id.toString()===e)return t}));s=i.permissions}else s=this.allActionIds;if(this.selected>0){var o=this.info.permissions;n.map((function(e){var t=0;e.actions.map((function(a){-1!==o.indexOf(a.id)&&e.selected.push(a.id),a.disabled=-1===s.indexOf(a.id),!1===a.disabled&&(t+=1)})),e.indeterminate=!!e.selected.length&&e.selected.length<t.length,e.checkedAll=e.selected.length===t}))}else n.map((function(e){e.actions.map((function(e){e.disabled=-1===s.indexOf(e.id)}))}))},openInfoModal:function(e){var t=this;this.selected=e.id,this.info=e,this.visible=!0,this.filterRuleAction(e.pid.toString()),this.$nextTick((function(){t.form.setFieldsValue({title:e.title,name:e.name,status:e.status,pid:e.pid.toString()})}))},openDataInfoModal:function(e){var t=this;this.dataVisible=!0,this.selected=e.id;var a=e.deptIds.map((function(e){return e.toString()}));this.checkedKeys=a,this.expandedDept(this.deptTreeData),this.$nextTick((function(){t.dataForm.setFieldsValue({title:e.title,name:e.name,mode:e.mode,deptIds:a})}))},expandedDept:function(e){var t=this;e.map((function(e){t.expandedKeys.push(e.value),void 0!==e.children&&t.expandedDept(e.children)}))},showDeleteConfirm:function(e){var t=this;this.$confirm({title:"确定删除此角色吗?",content:"",okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){var a=t.$message.loading("删除中..",0);u(e).then((function(e){t.$notification["success"]({message:"成功通知",description:"删除成功！"}),t.refreshTable()})).finally((function(e){a()}))}})},onChange:function(e){e.indeterminate=!!e.selected.length&&e.selected.length<e.actions.length,e.checkedAll=e.selected.length===e.actions.length},onCheckAllChange:function(e,t){var a=[];t.actions.map((function(e){!1===e.disabled&&a.push(e.value)})),Object.assign(t,{selected:e.target.checked?a:[],indeterminate:!1,checkedAll:e.target.checked})},rulesSelectedInit:function(e){var t=[];this.rules=e.map((function(e){return Object.assign(e,{selected:[],indeterminate:!1,checkedAll:!1}),e.actions.map((function(e){t.push(e.id),e.disabled=!1})),e})),this.allActionIds=t},handleTreeChange:function(e){this.filterRuleAction(e)},refreshTable:function(){this.$refs.table.refresh()},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t},handleMenuClick:function(){},expandIcon:function(e){var t=e.expanded,a=this.$createElement;return a("a-icon",!0===t?{attrs:{type:"down"}}:{attrs:{type:"right"}})},handleSelectChange:function(e){this.customDataVisable=2===e},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},onCheck:function(e){this.checkedKeys=e},onSelect:function(e,t){this.selectedKeys=e}}},v=f,b=a("2877"),g=Object(b["a"])(v,n,s,!1,null,null,null);t["default"]=g.exports}}]);